# マッチングシステム改修 — リサーチ・検証計画

**作成日**: 2026-02-09  
**根拠MTG**: 社内MTG（2026-02-09 メモ: `2026-02-09 13-35-08.txt`）  
**目的**: マッチングシステムの改修を進めるにあたり、検証が必要な要素を整理し、実現可能性を含めたリサーチを進行する。

---

## 実現可能性サマリ（結論）

| テーマ | 実現可能性 | 前提・検証事項 |
|--------|------------|----------------|
| **マッチング理由の生成** | ◎ 実現可能 | コスト（件数×LLM単価）と表示方法の検証が必要。ウィジェット開いたタイミングで上位 N 件だけ理由生成する方式で模索する。 |
| **成功データの蓄積・機械学習** | ○ 実現可能 | マッチング結果を「レコード」としてどこに保存するかの設計が必要。QuickML の CRM/Data Store 連携・エンドポイントは別リサーチで整理済み。 |
| **紹介メール・紹介したか確認** | ○ 実現可能 | 予測結果やマッチング理由をトリガーに、既存の CRM / メール連携で導線を組む。成功データの定義（成約 or 紹介済み）を決めると設計しやすい。 |

検証が必要な要素は **セクション 2** に一覧化し、**セクション 3** でリサーチ・検証の進め方を示している。

---

## 1. MTGで合意した改修の方向性

### 1.1 開発テーマの優先順位

| 優先度 | テーマ | 概要 | 備考 |
|--------|--------|------|------|
| **1位** | **マッチング理由の生成** | ウィジェットを開いたタイミングで「なぜこのマッチングになったか」をテキストで表示する | デモで映える。OpenAI/Gemini 等の API で都度生成する想定。まずこの実現方法を模索する |
| **2位** | **正解データを基にした機械学習** | 成約・成功データを溜め、QuickML 等で学習しマッチング精度向上・軸の重み付けに活かす | Zia AutoML は CSV/日本制限あり。QuickML で CRM 連携・定期同期の可否をリサーチ済み（別 doc 参照） |
| **導線** | **紹介メール送信まで** | マッチング理由を見せたうえで、紹介メールを送る導線と「紹介したか」の確認ができるようにする | 組み込めるとよい |

### 1.2 依頼事項（MTG結論）

- **最優先**: ウィジェットを開いたタイミングでリクエストを出し、**マッチング理由を生成する方法**を模索する。
- **並行**: 正解データ・機械学習（QuickML 等）の「どう引き出すか」「CRM からどう渡すか」はリサーチを進行する。手触りが分かっていない部分が多い。

---

## 2. 検証が必要な要素一覧（実現可能性含む）

いずれも「まだ検証が十分でない」「これから確認したい」点として整理する。

### 2.1 マッチング理由の生成

| 検証項目 | 現状の認識 | リスク・不明点 | リサーチ・検証タスク |
|----------|------------|----------------|----------------------|
| **トリガー** | ウィジェット表示時に 1 回リクエストを出す | — | 実装パターン（全件 vs 上位 N 件のみ）の検証 |
| **生成方式** | OpenAI / Gemini 等の API で「この 2 レコードがマッチした理由」を文章化 | 全件リクエストだとコスト増。1 件 1 コメント vs 「この人なのでこのランキング」の簡易版のトレードオフ | コスト試算（件数×単価）、プロンプト設計、キャッシュの要否 |
| **表示単位** | 「佐藤さんに対してこの求人がマッチした理由は〇〇」を画面に表示 | 画面構成はこれから検討 | デモ用の最小 UI で理由表示を実装し、体感で確認 |

**実現可能性**: 技術的には **実現可能**。コストと UX（遅延・表示方法）の検証が必要。

---

### 2.2 マッチング結果の「レコード化」と成功データ

| 検証項目 | 現状の認識 | リスク・不明点 | リサーチ・検証タスク |
|----------|------------|----------------|----------------------|
| **結果の永続化** | 現状はウィジェット上で計算した結果のみ。**マッチング結果をレコードとして持っていない** | 成功データを溜めるには「どの単位で・どこに」書くかの設計が必要 | CRM のカスタムモジュール or Catalyst Data Store に「マッチング結果＋成約フラグ」を保存する案の検討 |
| **Pinecone の役割** | 数値の類似度（ベクトル検索）を返しているだけ。紐付け・成約フラグは持たない | 成功データは別ストアで管理し、QuickML 等に渡す想定 | ワークフロー「成約したらパインコーン／Catalyst に成功データを渡す」動線の具体化 |
| **データ量** | 求人 100 × 求職者 100 → 1 万ペア。Pinecone には求人・求職者それぞれのベクトルが存在し、都度検索でマッチング | 全ペアを常にレコード化するか、成約したペアのみ記録するか | 成功データの定義（成約のみ / 紹介済みのみ 等）と保存単位の検証 |

**実現可能性**: **実現可能**。CRM または Data Store に「マッチング結果＋成約（紹介）フラグ」を書き、そのデータを QuickML 等に渡す流れの設計と PoC が必要。

---

### 2.3 ウィジェット・Pinecone の仕様詳細

| 検証項目 | 現状の認識 | リスク・不明点 | リサーチ・検証タスク |
|----------|------------|----------------|----------------------|
| **リクエスト単位** | 画面を開いたとき、開いているレコード ID を渡して「それに合いそうなマッチングを返して」とリクエスト | — | 仕様書・コードで「渡している ID（求職者 or 求人）」「返却件数」を明文化 |
| **上位 N 件** | 上位何件まで返すかは未検証・未明言 | N が大きいと理由生成コスト増 | 上位 3〜5 件など、デモとコストのバランスで N を決め、検証 |
| **絞り込み** | ウィジェットでレコード ID で絞り込みしている | 詳細条件は未検証 | フィルタ・名前空間の使い分けをコードと仕様で確認 |

**実現可能性**: 既存 PoC の範囲内で **確認可能**。ドキュメント化と小さな検証で足りる。

---

### 2.4 QuickML / 機械学習まわり

| 検証項目 | 現状の認識 | リスク・不明点 | リサーチ・検証タスク |
|----------|------------|----------------|----------------------|
| **Zia AutoML** | CSV/ファイルベース。日本だと使えない情報あり | リージョン制限の正確な確認 | 日本利用は **QuickML を前提**とする（別リサーチ doc で整理済み） |
| **QuickML** | CRM から定期でデータを取れるイメージ。モデル生成・訓練は Catalyst 内で実施 | **どう引き出すか（エンドポイント）** が手触り不明 | 公式ドキュメントで「エンドポイント発行・REST 呼び出し」を確認。必要なら小さいデータで試す |
| **データの流れ** | 「Catalyst で処理 → QuickML が定期で CRM から取得」で、システム上は QuickML を使う想定 | モデル訓練後の予測結果を CRM/ウィジェットでどう使うか未設計 | QuickML のエンドポイントを Catalyst 関数経由で叩き、マッチングスコアやランキングに使う案の検討 |

**実現可能性**: **要検証**。QuickML のエンドポイント取得・呼び出しを 1 本だけ試すと見通しが立つ。

---

## 3. リサーチ・検証の進め方（推奨）

### 3.1 短期（マッチング理由の生成）

1. **ウィジェット開いたタイミングで 1 回だけ** Catalyst 経由で LLM API（OpenAI or Gemini）を呼び、**返ってきた上位 N 件（例: 3 件）** について「この求人とこの求職者がマッチした理由」を 1 文ずつ生成する。
2. プロンプト案を作成し、**コスト（トークン数・単価）** を試算する。
3. ウィジェットのデモ用 UI に「マッチング理由」を表示する最小実装を行い、体感とコストを確認する。

### 3.2 中期（成功データと機械学習）

1. **成功データの定義**を決める（例: 成約したペアのみ / 紹介済みのみ）。
2. **保存先**を決める（CRM の関連レコード or Catalyst Data Store のテーブル）。
3. 「成約（紹介）したらそのペアを成功データとして 1 件書き込む」**ワークフロー or 関数**を 1 本だけ設計・PoC する。
4. QuickML の **データコネクタ（CRM or Data Store）・Periodic Sync・エンドポイント** を、既存リサーチ（`Zoho_Catalyst_AutoML_成約データ学習_リサーチ.md`）を参照しつつ、小さいデータセットで 1 回試す。

### 3.3 外部相談（MTGで言及）

- **アンチパターン（篠田さん・矢場さん等）**: マッチングのサービス化・API 化・ヘッドレス SaaS としてのアーキテクチャ、セキュリティ・個人情報の考慮点。
- **津田さん（りょうあ）**: Pinecone と Catalyst QuickML を組み合わせたアーキテクチャの妥当性、機械学習部分の設計。
- 上記の相談結果を、本ドキュメントの「検証が必要な要素」や「実現可能性」に反映する。

---

## 4. 参照ドキュメント

| ドキュメント | 内容 |
|--------------|------|
| `2026-02-09 13-35-08.txt` | 社内MTGメモ（本計画の根拠） |
| `Zoho_Catalyst_AutoML_成約データ学習_リサーチ.md` | Zia AutoML / QuickML の違い、成約データの格納・自動同期・エンドポイント |
| `feasibility-research.md` | マッチングシステム全体の実現可能性・コスト・アーキテクチャ |
| `architecture-specification.md` | CRM / Catalyst / Pinecone の現行アーキテクチャ・データフロー |

---

## 5. 更新履歴

| 日付 | 内容 |
|------|------|
| 2026-02-09 | 初版作成。MTGメモを反映し、検証項目とリサーチ・検証計画を整理。 |
| 2026-02-09 | **実装**: マッチング理由の生成を実装。Catalyst の search に `generate_reasons` パラメータを追加（OpenAI API で上位3件に理由を付与）。ウィジェットで理由を表示。要 OPENAI_API_KEY。 |
