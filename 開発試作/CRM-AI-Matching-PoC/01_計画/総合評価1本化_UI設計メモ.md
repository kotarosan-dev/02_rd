# マッチング「総合評価1本化」のUI設計メモ

## そもそもの要望（整理）

- **現状の課題**
  1. 「おすすめコメント」「なぜ一致したか」を**求人カードごとに1リクエスト**しており、トークン消費が大きい。
  2. トークン節約のため、**マッチング情報の総合評価を1つにまとめたい**（評価コメントを1本化）。
  3. その前提に**デザインがきちんと合うランキング**にしたい。

- **目指す形**
  - APIは「検索結果（ランキング）」＋「総合評価テキスト1件」を返す。
  - ウィジェットは「総合評価ブロック1つ」＋「ランキングカード（個別理由なし）」で構成する。

---

## 1. 総合評価を「1回のリクエストで1テキスト」にする

### API側の変更イメージ

- **現行**: `generate_reasons: true` → 上位N件それぞれに `reason` をLLMで生成（N回プロンプト）。
- **変更後**: `generate_summary: true` のようなフラグで、**マッチ結果全体を1プロンプト**で要約し、1つの `summary`（または `ai_analysis.summary`）だけを返す。

例のレスポンス形:

```json
{
  "success": true,
  "record_id": "...",
  "matches": [
    { "id": "...", "score": 64.3, "metadata": { ... } },
    { "id": "...", "score": 51.3, "metadata": { ... } }
  ],
  "summary": "求職者のJava/Spring Boot経験と希望職種・勤務地が上位求人と一致しています。テックリード志向と大阪勤務のニーズに合う求人が複数含まれています。"
}
```

- トークンは「1回の要約」だけなので、現状の「カード数ぶんの理由」より大幅に削減できる。
- カード側には `reason` を表示しない＝UIは「総合評価ブロック」＋「ランキングのみ」に寄せる。

---

## 2. デザインを「総合評価1本」に合わせる

### 2.1 画面構成（2ブロック）

| ブロック | 内容 | 役割 |
|----------|------|------|
| **A. 総合評価** | 1つのテキスト（＋必要なら折りたたみ） | 「このランキング全体の解釈」を伝える。AI生成であることが分かる見た目（✨・紫系など）。 |
| **B. ランキング** | 順位・タイトル・スコア・勤務地・年収・スキル等のみ | 個別の「なぜ」は書かず、スコアとメタ情報で比較しやすくする。 |

「おすすめコメント」は**Aに集約**し、Bのカードには**理由テキストを出さない**形にすると、要望とデザインが一致する。

### 2.2 総合評価ブロックの置き場所

- **上に置く案（推奨）**  
  - 検索結果の「要約を先に読む」パターン（Perplexity・Bloomberg等と同様）。  
  - ユーザーは「まず総合評価で文脈を把握 → 下のランキングで詳細を見る」という流れになる。
- **下に置く案**  
  - 「自分の目でランキングを先に確認 → 最後にAIの解釈で裏付け」というワークフローに合う。
- **折りたたみ**  
  - どちらでも、総合評価は**折りたたみ可能**にしておくと、ランキングだけ見たい人にも優しい。

ワイヤーイメージ（上置き・折りたたみあり）:

```
┌─────────────────────────────────────────────┐
│ ✨ マッチングの総合評価            [▾ 閉じる] │
│ ─────────────────────────────────────────── │
│ 求職者のJava/Spring Boot経験と希望職種・      │
│ 勤務地が上位求人と一致しています。            │
│ テックリード志向と大阪勤務のニーズに合う      │
│ 求人が複数含まれています。                   │
└─────────────────────────────────────────────┘

│ ① テックリード           ◉ 64%  │
│    大阪 · 700-1000万円 · Java…   │
├─────────────────────────────────┤
│ ② シニアバックエンド…    ◉ 51%  │
│    東京(リモート可) · 600-900万… │
└─────────────────────────────────┘
```

### 2.3 ランキングカード側のデザイン

- **出すもの**: 順位・タイトル（または名前）・**円形スコア**・勤務地・年収・スキル等のタグ。
- **出さないもの**: カードごとの「なぜ一致したか」テキスト（APIでも返さない想定）。
- トップ3のメダル表現・色分けはそのまま活かすと、「ランキング」らしさが保てる。
- カードは「クリックでレコードを開く」だけにし、**インライン展開で詳細やレーダーチャートを出す**のは Phase 2 以降にしてもよい。

これで「総合評価は1ブロック」「ランキングはスコアとメタで見せる」という一貫したデザインになる。

---

## 3. 実装の進め方（短いチェックリスト）

1. **API（Catalyst）**
   - `generate_reasons: true` をやめ、`generate_summary: true`（または同等）を追加。
   - マッチ結果リストを1つのプロンプトで要約し、`summary` 1本だけ返す。
2. **ウィジェット**
   - レスポンスの `summary` を「総合評価ブロック」用に表示する。
   - カード描画では `match.reason` を参照・表示しない（廃止または未使用のまま）。
   - 総合評価ブロックは**折りたたみ可能**にし、配置は「上」または「下」のどちらかで統一。
3. **デザイン**
   - 総合評価は「AI生成」と分かるスタイル（✨・紫のアクセント・左ボーダー等）を維持。
   - ランキングは現行の円形スコア＋ランク＋メダルを維持し、理由エリアだけ削除。

---

## 4. 今後の「UI/UXスキル」に含めると良さそうなこと

Zoho CRM ウィジェットで再現するためのデザインを考える人向けのスキルに、次のような要素を入れておくと、今回の「総合評価1本化」のような判断にも使える。

- **制約の明文化**
  - iframe・幅300〜800px、ZIP 25MB/250ファイル、CDN可、SDK v1.5（Resize、CONNECTION.invoke 等）。
  - 「何ができないか」より「何ができるか」をはっきり書く（Chart.js/CSS/SVG、sticky、折りたたみ等）。
- **情報の塊の単位**
  - 「1画面／1ウィジェットで伝えるメッセージは何か」「ブロックは何個に分けるか」（例: 総合評価1ブロック ＋ ランキング1ブロック）。
  - リストは「ランキング」「フィルタ」「総合コメント」のように役割ごとに分けると設計しやすい。
- **トークン・コストとUIの対応**
  - 「APIを1回にまとめたい」→「UIは1つの総合評価ブロックで受け取る」のように、**APIの呼び出し回数・返す情報の数と、画面のブロック構成を対応させる**考え方。
- **パターンの名前を付けておく**
  - 例: 「総合評価1本 ＋ ランキングリスト」「フィルターバー ＋ カードリスト ＋ フッター」など。同じパターンを他ウィジェットでも流用しやすくする。
- **参照ドキュメント**
  - 今回の compass 分析（4セクション構成・円形スコア・AIパネル・色使い）や、この「総合評価1本化」メモを、スキル内の「Zoho CRM ウィジェットの事例」として参照できるようにする。

このメモは、**総合評価1本化の要件とUIの対応関係**を説明するドキュメントとしても、**スキル作成時の設計観点**としても使えるようにしてある。
