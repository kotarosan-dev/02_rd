# Slack返信用：必須フィルタ＋ベクトル検索の可否（宮村さん質問への回答）

**日付**: 2026-02-03  
**質問者**: 宮村佳祐  
**質問**: 人材紹介の場合、必須となるフィルタ軸（就労地域や職種など）をクライアント毎にかけたうえでベクトル検索でマッチングさせることは可能か。

---

## 回答（Slackに貼る用）

**結論：可能です。**

CRM AI Matching POCで使っているPineconeは、検索時に **メタデータフィルタ** を指定できます。  
「就労地域＝関西」「職種＝エンジニア」といった必須条件をフィルタとして渡し、**その条件を満たす求人だけを対象に**ベクトル類似度検索を行う、という流れが実現できます。

- **必須フィルタ（クライアント毎）**: 就労地域・職種などをメタデータで絞り込み  
- **AIマッチング軸**: 上記で絞った候補に対して、意味的な類似度（ベクトル検索）でランキング  

現在のPoC実装ではまだ検索にフィルタは渡していませんが、アーキテクチャ仕様では「勤務地・年収範囲でのフィルタ」を今後の拡張として想定しており、求人データも `location`・`position`・`salary` などをメタデータで保存しているため、拡張で対応可能です。

実装イメージ：クライアント（または案件）ごとの必須条件をCRM側で保持し、マッチング検索リクエスト時にその条件をCatalyst経由でPineconeの検索APIに `filter` として渡す形になります。

---

## 補足（必要に応じて）

- Pineconeのメタデータフィルタは `$eq`（一致）、`$in`（いずれかに一致）などをサポート。
- メタデータはフラットなキー・値のみ（ネスト不可）。現状の求人メタデータはその形式で問題なし。
- クライアント毎の必須条件を「どこで管理するか」（CRMのカスタム設定、関連オブジェクト、リクエストパラメータなど）は要件に応じて設計が必要。
