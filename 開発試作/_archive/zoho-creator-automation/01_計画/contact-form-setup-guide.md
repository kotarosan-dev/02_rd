# お問い合わせフォーム作成ガイド（Zoho Creator）

SampleApp_01 内でお問い合わせフォームを作成し、API名・選択肢を設定する手順。

## 前提

- アプリ「SampleApp_01」は作成済み
- 編集画面: `https://creator.zoho.jp/appbuilder/kotarosan2/sampleapp-01/edit`
- **「新しいフォームの作成」は手動で1回クリック**（app builder 内の iframe/スクロールのため MCP からクリックできない場合あり）

---

## Step 1: フォームを作成

1. 画面中央の **「新しいフォームの作成」** をクリック
2. フォーム名を入力（例: `お問い合わせ`）
3. API名を **意味のある名前に変更**: `contact_form` または `inquiry_form`
4. 「作成」または「OK」をクリック

---

## Step 2: フィールド追加とAPI名

フォームに以下のフィールドを追加する。**表示名**と**API名（英数字）**を対応させる。

| 表示名 | フィールドタイプ | API名 | 備考 |
|--------|------------------|--------|------|
| お名前 | テキスト（1行） | `contact_name` | 必須 |
| メールアドレス | メール | `contact_email` | 必須 |
| お問い合わせ種別 | 選択肢（ドロップダウン） | `inquiry_type` | 選択肢は下記 |
| 件名 | テキスト（1行） | `subject` | 任意 |
| お問い合わせ内容 | テキスト（複数行） | `message` | 必須 |
| 会社名 | テキスト（1行） | `company_name` | 任意 |
| 電話番号 | 電話番号 | `phone` | 任意 |

### 選択肢「お問い合わせ種別」(inquiry_type) の値

| 表示ラベル | 保存する値（API名と一致推奨） |
|------------|------------------------------|
| 製品について | `product` |
| サポート | `support` |
| 採用について | `recruitment` |
| その他 | `other` |

---

## Step 3: 各フィールドの設定ポイント

1. **API名**
   - 半角英数字・アンダースコアのみ
   - 例: `contact_name`, `inquiry_type`
   - フォーム編集画面で「設定」→「API名」で変更

2. **選択肢フィールド**
   - タイプ: 「選択肢」または「ドロップダウン」
   - オプションを上記の4つ（製品について / サポート / 採用について / その他）で追加
   - 値は `product`, `support`, `recruitment`, `other` にするとAPI・Delugeで扱いやすい

3. **必須**
   - お名前、メールアドレス、お問い合わせ内容を必須にするとよい

---

## Step 4: 動作確認

1. ヘッダーの **「このアプリケーションにアクセス」** でプレビュー
2. お問い合わせフォームが表示されることを確認
3. 各フィールドに入力し、選択肢を選んで送信
4. レコードが保存されることを確認

---

## MCP で自動化する場合の注意

- **「新しいフォームの作成」ボタン**: app builder が iframe や内部スクロールを使っていると、`browser_click` で「Could not scroll element into view」になることがある
- **対処**: 上記 Step 1 だけ手動で実行し、フォーム名・API名入力画面が出たら、以降は MCP で `browser_type` / `browser_click` を続けられる可能性あり
- **ref**: ページごとに変わるため、操作のたびに `browser_snapshot` で ref を取得してからクリック・入力する

### ドラッグ＆ドロップ（フィールド追加）の自動化について

- **現状**: Zoho Creator のフォームビルダーは **jQuery UI のドラッグ**（`ui-draggable` / `ui-draggable-handle`）を使用しており、HTML5 の `draggable` 属性は使っていない。
- **cursor-ide-browser の `browser_drag`**: 内部で「要素が `draggable="true"` か」をチェックするため、**jQuery UI のドラッグには対応していない**（「Source element does not appear to be draggable」となる）。
- **結論**: **MCP だけではフォームビルダー内のドラッグ＆ドロップは自動化できない**。フィールド追加は手動でドラッグするか、別手段を検討する。
- **代替案**:
  1. **手動でドラッグ**: 左の「基本項目」からキャンバスへドラッグ（推奨・確実）。
  2. **Playwright 単体スクリプト**: `page.mouse` で `mousedown` → `mouse.move(x,y)` → `mouse.up()` のシーケンスを送り、jQuery UI のドラッグを模倣する。MCP の承認ダイアログを避けたい場合に検討。
  3. **Zia の「項目の候補を提案」**: ワンクリックで項目を自動追加できる場合がある。追加後に API 名などを手動で整える。

---

## 分業ワークフロー：項目一覧＋手動追加＋API名の自動化

**流れ**

1. **AI**: 項目一覧（リストのみ）を作成 → ユーザーに渡す  
2. **ユーザー**: フォームビルダーで上から順にフィールドをドラッグで追加（操作は手動）  
3. **ユーザー**: 「API名を変更する操作を自動化して」と依頼  
4. **AI**: MCP で各フィールドをクリック → 設定で「API名」を入力 → 適用、を繰り返し実行  

**前提**

- フォームビルダー画面が開いていること  
- ユーザーが **下記の順で** フィールドを1つずつキャンバスに追加済みであること（順序が違うと API 名の割り当てがずれる）  
- 「API名」入力欄や「適用」ボタンが MCP のスナップショットで ref 取得できること（実行時に確認）

---

## 項目一覧（ユーザー操作用・この順で追加）

フォームビルダーで、**左の「基本項目」からキャンバスへ、次の順に1つずつドラッグして追加**する。

| # | 基本項目で選ぶもの | 追加後の表示名（任意で変更可） | この項目のAPI名（自動化で設定） |
|---|-------------------|------------------------------|----------------------------------|
| 1 | 名前 | お名前 | `contact_name` |
| 2 | メール | メールアドレス | `contact_email` |
| 3 | ドロップダウン | お問い合わせ種別 | `inquiry_type` |
| 4 | 一行 | 件名 | `subject` |
| 5 | 複数行 | お問い合わせ内容 | `message` |
| 6 | 一行 | 会社名 | `company_name` |
| 7 | 電話 | 電話番号 | `phone` |

- **ドロップダウン（お問い合わせ種別）**: 追加後、選択肢を手動で「製品について」「サポート」「採用について」「その他」にし、値は `product` / `support` / `recruitment` / `other` にするとよい（自動化対象外）。  
- 上記を **すべて追加し終えたら**、「API名を変更する操作を自動化して」と依頼する。

---

## API名変更の自動化（依頼時の前提と手順）

**ユーザーが依頼するときの前提**

- フォームビルダー画面（`/formbuilder/form/edit`）を開いた状態  
- 上記「項目一覧」のとおり、**1〜7の順で** フィールドをキャンバスに追加済み  
- 追加だけ完了しており、API名はまだデフォルトのまま（または未設定）でよい  

**自動化で行うこと（想定）**

1. キャンバス上の **1つ目のフィールド** をクリック → 右側に設定パネルが開く  
2. 設定内の「API名」入力欄に `contact_name` を入力  
3. 適用／確定ボタンをクリック（あれば）  
4. 同様に **2つ目〜7つ目** について、順に `contact_email`, `inquiry_type`, `subject`, `message`, `company_name`, `phone` を設定  
5. 必要なら「完了する」で保存  

**注意**

- Zoho Creator では API 名は **「項目のリンク名」**（Item Link Name）の入力欄で設定する。  
- 実際に実行するときに `browser_snapshot` で「項目のリンク名」入力欄の ref が取れるか確認する。取れない場合は、パネルが iframe 内だったりラベルだけで ref が付いていない可能性があり、そのときは手動で1項目だけ設定してから再度スナップショットを取得して依頼する。  
- フィールドを切り替えると右パネルの ref が変わるため、**クリック直後のスナップショット**から「項目のリンク名」の ref を取得してから fill する必要がある。ref が古いと「Element not found」になる。  
- フィールドの並び順を変えた場合は、「#1 がお名前、#2 がメール…」と対応がずれるので、一覧どおりの順で追加した場合のみこの自動化を前提にしている。

---

## 作成後のAPI名一覧（参照用）

```
contact_name      … お名前
contact_email     … メールアドレス
inquiry_type      … お問い合わせ種別（product / support / recruitment / other）
subject           … 件名
message           … お問い合わせ内容
company_name      … 会社名
phone             … 電話番号
```

---

## APIによるフォーム・フィールド操作の可否（2026年2月調査）

### 結論

**Zoho Creator API ではフォームやフィールドの「作成・変更」はできない。**

| API種別 | できること | フィールド作成・変更 |
|---------|------------|---------------------|
| **Data API** | レコードの追加・更新・削除 | **不可** |
| **Meta API** | フィールド情報の取得（読み取り専用） | **不可** |
| **File API** | ファイルのアップロード・ダウンロード | **不可** |
| **Bulk API** | 大量データのエクスポート | **不可** |
| **Custom API** | カスタムエンドポイント作成（データ操作用） | **不可** |

- Meta API（`GET /meta/.../fields`）はフィールド情報を「取得」できるが、「作成・変更」はできない。
- Deluge スクリプトでも、フィールドの「値」や「表示/非表示」は制御できるが、フィールド定義（型、API名など）の変更は不可。

### 代替アプローチ

#### 1. DS File（Deluge Script File）を活用

**概要**: Zoho Creator アプリの「構造全体」をテキストファイルとしてエクスポート/インポートできる。

- **何が保存される**: フォーム、フィールド、レポート、ページ、Deluge スクリプト、設定
- **保存されないもの**: データ（レコード）

**ワークフロー**:
1. 手動で1つベースとなるフォームを作成（フィールド含む）
2. **Settings → Application IDE → Export** で DS File をダウンロード
3. テキストエディタで DS File を編集（フィールド追加・API名変更など）
4. 新規アプリまたは別アプリに DS File をインポート

**メリット**:
- 一度作成した構造をテンプレート化し、複数プロジェクトで再利用
- Git でバージョン管理可能
- テキストベースなので diff や自動生成しやすい

**制限**:
- DS File の構文ドキュメントが公式に詳しく公開されていない
- 構文を知るには、既存アプリをエクスポートして解析する必要がある

---

#### 2. CSV/Excel インポートでフィールド自動生成

**概要**: データファイルをインポートすると、AI（Zia）がカラムからフィールド型を推測して自動作成。

**手順**:
1. フィールド定義を反映した「ヘッダー行＋サンプルデータ行」を持つ CSV/Excel を用意
2. Creator の「Import」機能でファイルをアップロード
3. Zia がカラム名とデータ型を推測し、フォームを自動生成

**メリット**:
- Excel でフィールド設計を管理できる
- AI がデータ型を推測してくれる

**制限**:
- API名（リンク名）は自動生成されるため、後から手動調整が必要
- 細かい設定（必須、選択肢の値など）は手動

---

#### 3. アプリケーション複製（テンプレート運用）

**概要**: 既存アプリを「構造のみ」で複製し、テンプレートとして再利用。

**手順**:
1. ホーム画面でアプリの横にある「Duplicate」をクリック
2. 「構造のみ（データなし）」を選択してコピー
3. 新しいアプリで必要に応じて調整

**メリット**:
- 一度作ったフォーム構造を何度も再利用
- 手動作業の繰り返しを削減

---

### 推奨ワークフロー（効率化の観点から）

| シナリオ | 推奨アプローチ |
|----------|----------------|
| **初回構築** | 手動でフォームを作成（GUI が最も確実） |
| **同じ構造を複数アプリで使いたい** | DS File エクスポート → 編集 → インポート |
| **大量のフィールドを一括定義したい** | CSV インポート → API名を手動調整 |
| **既存アプリを複製したい** | アプリケーション複製（Duplicate） |
| **API名・表示名の変更のみ** | MCP（本ガイドの手順）または手動 |

### 参考リンク

- [Meta API - Get Fields](https://www.zoho.com/creator/help/api/v2/get-fields.html)
- [DS File について（Creator 5）](https://www.zoho.com/creator/newhelp/app-settings/understand-ds-file.html)
- [Application IDE](https://www.zoho.com/creator/newhelp/app-settings/view-and-modify-application-ide.html)
